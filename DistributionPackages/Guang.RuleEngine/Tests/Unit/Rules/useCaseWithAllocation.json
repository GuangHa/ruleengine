[
    {
        "if": [
            {"missing": [true, {"var": ""},["AHU"]]},
            {"group": [{"create": [[], ["id", 0], [
                "height",
                {"sqrt": [{"/": [{"/": [{"/": [{"+": {"map":[{"var":["", null, true]}, {"var":"room_volume"}]}}, 3600]}, 1]}, 1.5]}, 2]}
            ]]}, "AHU"]},
            {"modify": [{"var": ""}, "AHU.height", {"sqrt": [{"/": [{"/": [{"/": [{"+": {"map":[{"var":["", null, true]}, {"var":"room_volume"}]}}, 3600]}, {"count": {"var": "AHU"}}]}, 1.5]}, 2]}]}
        ]
    },
    {
        "if": [
            {">": [{"var": "AHU.0.height"},{"var": ["0.room_unbounded_height", null, true]}]},
            {"group": [{"merge": [{"var": "AHU"},{"create": [[], ["id", {"count": {"var": "AHU"}}], ["height", {"var": "AHU.0.height"}]]}]}, "AHU"]},
            {"var": ""}
        ]
    },
    {
        "if": [
            {"and": [{"missing": [true, {"var": "AHU"}, ["0.room_id"]]}, {"<=": [{"var": "AHU.0.height"},{"var": ["0.room_unbounded_height", null, true]}]}]},
            {"group": [{"map": [{"var": "AHU"}, {"modify": [{"var": ""}, "room_id",
                {"var": ["0.id", null, false,{"slice": [{"var": ["", null, true]}, {"%": [{"var": "id"}, {"count": {"var": ["", null, true]}}]}, 1]}]}
            ]}]}, "AHU"]},
            {"var": ""}
        ]
    },
    {
        "if": [
            {"missing": [true, {"var":""}, ["DATA"]]},
            {"join": [{"group": [{"var": ["", null, true]}, "DATA"]}, {"var": ""}]},
            {"var":""}
        ]
    }
]